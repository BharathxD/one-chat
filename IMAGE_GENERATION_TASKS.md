# OpenAI Image Generation Integration

Brings DALL-E / GPT-Image-1 style image creation into the chat experience. The feature streams a loading placeholder, calls the OpenAI image endpoint, stores the result in Vercel Blob, then updates the chat with the final image attachment.

## Completed Tasks

- [x] Drafted architectural plan for backend & frontend changes

## In Progress Tasks

- [x] Update `apps/web/app/api/chat/route.ts` with image-generation branch
- [x] Upload generated bytes to Vercel Blob via `put` (server-side)
- [x] Persist image as `attachment` + `message_attachment`
- [x] Send placeholder & completed annotations over resumable stream
- [x] Update chat UI component to render image attachments and show spinner while `status === "streaming"`

## Future Tasks

- [ ] Allow users to pick size / quality parameters
- [ ] Add usage limits & pricing banners
- [ ] Handle image-generation errors gracefully in UI (retry button)
- [ ] Extend to other providers (Gemini, Fal, etc.)

## Implementation Plan

1. **Backend (route handler)**
   â€¢ Detect `selectedModel === "openai:gpt-imagegen"`  
   â€¢ Immediately emit placeholder assistant message with `status:'streaming'`  
   â€¢ Call `experimental_generateImage` (AI-SDK) with 1024Ã—1024 default size  
   â€¢ `put()` the `base64` into Blob store (`chat-images/{assistantMsgId}.png`)  
   â€¢ Create `attachment` row and link to assistant message  
   â€¢ Upsert assistant message (`status:'done'`) and emit final stream events

2. **UI**  
   â€¢ If message has `attachmentIds` & `status!=='done'` â†’ show skeleton loader  
   â€¢ Once `status:'done'` and Blob URL known â†’ render via `<Image>`  
   â€¢ Ensure Blob hostname is whitelisted in `next.config.mjs`

3. **Env / Config**  
   â€¢ `OPENAI_API_KEY` â€” already present  
   â€¢ `VERCEL_BLOB_READ_WRITE_TOKEN` â€” required for server upload  
   â€¢ Add remote pattern for `*.blob.vercel-storage.com`

### Relevant Files

- `apps/web/app/api/chat/route.ts` â€“ ðŸ”„ add image-generation branch
- `apps/web/lib/actions/chat.ts` â€“ âœ… helpers already handle attachments
- `apps/web/components/chat/message.tsx` â€“ ðŸ”„ render image & spinner
- `next.config.mjs` â€“ ðŸ”„ add Blob remote pattern 